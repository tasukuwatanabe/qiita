---
title: シェルスクリプトでの true と false コマンドの戻り値について
tags:
  - ''
private: true
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---

## はじめに

こんにちは。HRBrainでオウンドメディア・ランディングページの開発を担当している渡邉です。

シェルスクリプトを使った開発では、条件分岐やループ処理を実現する際にコマンドの**戻り値（終了ステータス）**が非常に重要です。

`true` と `false` というシンプルなコマンドは、条件式の成功・失敗をコントロールするためにしばしば使われます。

この記事では、`true` や `false` コマンドの動作、実際の使用例、そしてこれらを利用する際の注意点について詳しく解説していきます。

## シェルスクリプトにおける戻り値とは？

シェルスクリプトでコマンドを実行すると、**終了ステータス**という形で結果が返されます。終了ステータスは0から255までの整数で表され、通常以下のルールで解釈されます。

- `0`: 成功を意味します（真）
- `0 以外`: 失敗を意味します（偽）

この終了ステータスを元に、スクリプト内で条件分岐やエラーハンドリングを行うことができます。

## `true` コマンド

### 動作
`true` コマンドは、その名の通り「常に真」を返します。つまり、実行するたびに**終了ステータス `0`**を返すシンプルなコマンドです。シェルスクリプト内で使うと、「何もせずに成功する」という動作を示します。

```bash
#!/bin/bash
true
echo $?  # 0 が表示される
```

### 使用例
たとえば、無限ループを作成する際に `true` はよく使われます。

```bash
#!/bin/bash
while true; do
  echo "無限ループ中..."
  sleep 1
done
```

このスクリプトは、`true` が常に `0`（成功）を返すため、ループが終了せず永遠に動き続けます。

## `false` コマンド

### 動作
`false` は、常に「失敗」を意味する終了ステータス**1**を返します。このため、条件式の中で「常に失敗させたい」場合に利用できます。

```bash
#!/bin/bash
false
echo $?  # 1 が表示される
```

### 使用例
`false` コマンドは、条件分岐のテストや意図的にスクリプトを失敗させる場合に使われます。

```bash
#!/bin/bash
if false; then
  echo "このメッセージは表示されません"
else
  echo "false により、このメッセージが表示されます"
fi
```

この例では、`false` が `1` を返すため `else` ブロックが実行され、メッセージが表示されます。

## 実践例：終了ステータスの確認

シェルスクリプト内では、直前に実行されたコマンドの終了ステータスを特殊変数 `$?` を使って確認できます。以下の例では、`true` と `false` の終了ステータスを確認しています。

```bash
#!/bin/bash
true
echo "true の終了ステータス: $?"

false
echo "false の終了ステータス: $?"
```

このスクリプトを実行すると、以下の出力が得られます。

```
true の終了ステータス: 0
false の終了ステータス: 1
```

## 落とし穴：`true` と `false` を使う際の注意点

### 1. 誤って `false` を使う
`false` コマンドは、意図的に失敗を発生させるためのものであり、実行すると終了ステータス `1` を返します。しかし、間違えて `false` を条件分岐に利用してしまうと、予期しない動作につながることがあります。

```bash
#!/bin/bash
if false; then
  echo "意図的に失敗を返すべき箇所で true を期待してしまった"
fi
```

ここで `true` とすべきところを `false` としてしまうと、意図的に成功させたい部分が失敗として扱われます。

### 2. 終了ステータスの確認を忘れる
特に大規模なスクリプトでは、コマンドの終了ステータスを適切に確認しないと、思わぬエラーがスルーされる可能性があります。重要な処理の直後には、`$?` で終了ステータスを確認し、適切なエラーハンドリングを行うことが必要です。

```bash
#!/bin/bash
some_command
if [ $? -ne 0 ]; then
  echo "エラーが発生しました"
  exit 1
fi
```

（注: 画像があれば、終了ステータスの確認方法を視覚的に説明すると理解しやすくなります）

## まとめ

`true` と `false` コマンドは、シェルスクリプトにおける条件分岐やループ制御で基本的かつ重要な役割を果たします。`true` は常に成功（終了ステータス `0`）、`false` は常に失敗（終了ステータス `1`）を返すため、それぞれの特性を理解して使うことで、スクリプトのロジックをより確実にコントロールできます。

コマンドの終了ステータスを正しく確認し、`$?` を適切に利用することで、バグを防ぎやすくなるので、この仕組みをしっかり押さえておきましょう。

## PR

HRBrainでは積極的に採用を行なっています！

https://www.hrbrain.co.jp/recruit
